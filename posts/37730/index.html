<!DOCTYPE html>












  


  


<html class="theme-next pisces use-motion han-js-rendered no-han-space" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






  <!--  -->
  
  
  <link rel="stylesheet" href="https://ethantw.github.io/Han/latest/han.min.css">



  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">














  
  
  
  

  

  

  

  

  

  







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">



  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico?v=7.1.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="article">
<meta property="og:title" content="【翻译】使用Swift语言来进行数据科学研究的指南">
<meta property="og:url" content="http://www.codewoody.com/posts/37730/index.html">
<meta property="og:site_name" content="治部少辅">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/b5e001b9f8a4d9dafcd5ec496a58de85.jpg">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/8f315354975c79b64987964329b23705.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/36f6165e5e466fe6807e0f869064b38c.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/451eba98fbef8b87bf2473971390e66f.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/38eccdfe56ca3db57c311b890bf47df7.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/a7703331c5c85017c96ec42db8c30ac3.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/ab6365a6d34703b1ef7dd5c72d67e200.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/9223622e676db4d5e4cb7b29029d2b2c.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/d0bfb4405b609c516a0496dcf9d5d6fb.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/b0ca21f0935f746d295e396801745a8d.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/8eb4727e890c2a4a24e5bacff634c764.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/4505b19dc02e603f5e155e899b4073a7.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/5b367d407d32802ecce0bcd33b3e9f9a.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/0db98a3b3315f281946c68ec3ad9cf57.png">
<meta property="og:updated_time" content="2020-01-15T08:07:20.709Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【翻译】使用Swift语言来进行数据科学研究的指南">
<meta name="twitter:image" content="https://imgs.codewoody.com/uploads/big/b5e001b9f8a4d9dafcd5ec496a58de85.jpg">



  <link rel="alternate" href="/atom.xml" title="治部少辅" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://www.codewoody.com/posts/37730/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>【翻译】使用Swift语言来进行数据科学研究的指南 | 治部少辅</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-114736006-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-114736006-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">治部少辅</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">大一大万大吉</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-knowledge">

    
    
    
      
    

    

    <a href="/knowledge-base" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i> <br>knowledge</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-weekly">

    
    
    
      
    

    

    <a href="/categories/Weekly/" rel="section"><i class="menu-item-icon fa fa-fw fa-newspaper-o"></i> <br>weekly</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-updates">

    
    
    
      
    

    

    <a href="/update" rel="section"><i class="menu-item-icon fa fa-fw fa-edit"></i> <br>updates</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-channel">

    
    
    
      
    

    

    <a href="https://t.me/everthingaboutbullshit" rel="noopener" target="_blank"><i class="menu-item-icon fa fa-fw fa-signal"></i> <br>channel</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/huangy10" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.codewoody.com/posts/37730/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="治部少辅">
      <meta itemprop="description" content="晚来天雨雪，能饮一杯无？">
      <meta itemprop="image" content="https://imgs.codewoody.com/uploads/big/0330eb8242d9bfc4873c11450f0ab691.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="治部少辅">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">【翻译】使用Swift语言来进行数据科学研究的指南

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-11-29 23:06:56" itemprop="dateCreated datePublished" datetime="2019-11-29T23:06:56+08:00">2019-11-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-01-15 16:07:20" itemprop="dateModified" datetime="2020-01-15T16:07:20+08:00">2020-01-15</time>
              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/posts/37730/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/37730/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             Views:  
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <blockquote>
<p>Swift是苹果公司研发的用来取代Objective C进行苹果生态系统下软件开发的语言。而且苹果对于Swift的野心不至于一款APP专用的开发语言而已。 从Swfit语言发布以来，苹果公司就将Swift开源，并且在Swift版本迭代过程中积极听取来自普通开发者的意见。苹果致力于将Swift打造成跨平台的 通用变成语言。我从Swfit发布起就开始使用了，当时接触Swift的时候就为其所吸引，其引入的很多特性，如Type Interference， Optional，以及 简洁的语言形式等等，都能搞大大提高生产效率，并且提高程序的可读性。</p>
<p>现在我已经不怎么做iOS的开发的，用Swift也偏少。这两天突然看到了一篇名为<a href="https://www.analyticsvidhya.com/blog/2019/10/comprehensive-guide-learn-swift-from-scratch-data-science/" target="_blank" rel="noopener">A Comprehensive Guide to Learn Swift from Scratch for Data Science</a>的文章，便想立刻通读一遍，也许在之后我可以多用Swift来做研究方面的内容。</p>
</blockquote>
<h2 id="overview">Overview</h2>
<ul>
<li>Swift很快就成为了最为强大和有效的数据科学变成语言之一；</li>
<li>Swift和Python比较类似，因此你可以很容易地迁移到Swift上；</li>
<li>这里我们将会涉及Swift的基础知识，并学会如何快速搭建第一个数据科学模型；</li>
</ul>
<h2 id="简介">简介</h2>
<p>Python在数据科学的领域的火热程度自然不用多少，各种各样的排名和调查都将Python列为数据科学编程语言的佼佼者。</p>
<blockquote>
<p>Python本身是非常灵活的，作为动态语言，你在使用Python不太需要遵守很多变成方面的潜规则，这带来很大的灵活性。不过这导致随着项目复杂度的增长，维护Python项目会变得比较困难。当然，性能也是一个重要的因素。一般脚本级别的数据科学应用，Python的性能并不突出，Python一般被用来当做胶水语言，主要的计算一般是其他语言实现的模块来完成。不过复杂项目中Python的性能还是会成为一个瓶颈。</p>
</blockquote>
<p>不过要记住的一点是，数据科学是一个含义广泛且不断演化的学科。因此其使用的语言也要不断演化。还记得R语言在数据科学中扮演老大角色的日子吗？与Python同时兴起的还有Julia语言。</p>
<p>没错，这里我们就要来讨论一下将Swift语言应用到数据科学中。</p>
<p><img src="https://imgs.codewoody.com/uploads/big/b5e001b9f8a4d9dafcd5ec496a58de85.jpg"></p>
<blockquote>
<p>“I always hope that when I start looking at a new language, there will be some mind-opening new ideas to find, and Swift definitely doesn’t disappoint. Swift tries to be expressive, flexible, concise, safe, easy to use, and fast. Most languages compromise significantly in at least one of these areas.” – Jeremy Howard</p>
</blockquote>
<p>当<a href="https://en.wikipedia.org/wiki/Jeremy_Howard_(entrepreneur)" target="_blank" rel="noopener">Jeremy Howard</a>【~Howard was the President and Chief Scientist at Kaggle】为一个语言背书，且将这门语言应用到他的日常数据科学研究中时，你就应该暂时停止你手上的工作好好听一听了。</p>
<p>在这这篇文章中我们将学习Swift编程语言，以及如何将其应用到数据科学领域中【~原作者真啰嗦】。如果你是Python用户，你会发现Swift和Python之间有很多的相似性。</p>
<h2 id="why-swift">Why Swift?</h2>
<blockquote>
<i>“PyTorch was created to overcome the gaps in Tensorflow. FastAI was built to fill gaps in tooling for PyTorch. But now we’re hitting the limits of Python, and Swift has the potential to bridge this gap” </i>
<p style="text-align: right">
<i>– Jeremy Howard</i>
</p>
</blockquote>
<p>今年来数据科学领域对于Swift的兴趣日渐增长，几乎人人都在讨论这个话题。以下是你要学习Swfit语言的几个原因：</p>
<ul>
<li>Swift很快，几乎接近C语言的水平；</li>
<li>与此同时，Swift语言非常简洁，可读性很高。这和Python类似。【~个人认为Swift的可读性可比Python高多了】；</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyModel</span>: <span class="title">Layer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> conv = <span class="type">Conv2D</span>&lt;<span class="type">Float</span>&gt;(filterShaper: (<span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>))</span><br><span class="line">  <span class="keyword">var</span> pool = <span class="type">MaxPool2D</span>&lt;<span class="type">Float</span>&gt;(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">var</span> flatten = <span class="type">Flatten</span>&lt;<span class="type">Float</span>&gt;()</span><br><span class="line">  <span class="keyword">var</span> dense = <span class="type">Dense</span>&lt;<span class="type">Float</span>&gt;(<span class="number">16</span> * <span class="number">5</span> * <span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">  </span><br><span class="line">  @differentiable</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">call</span><span class="params">(<span class="number">_</span> input: Tensor&lt;Float&gt;)</span></span> -&gt; <span class="type">Tensor</span>&lt;<span class="type">Float</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> dense(flatten(pool(conv(input))))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModel</span><span class="params">(nn.Model)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">    super().__init__()</span><br><span class="line">    self.conv = nn.Conv2d(<span class="number">3</span>, <span class="number">6</span>, kernal_size=<span class="number">5</span>)</span><br><span class="line">    self.pool = nn.MaxPool2d(<span class="number">2</span>)</span><br><span class="line">    self.flatten = Flatten()</span><br><span class="line">    self.dense = nn.Linear(<span class="number">16</span> * <span class="number">5</span> * <span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, input)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.dense(self.flatten(self.pool(self.conv(input))))</span><br></pre></td></tr></table></figure>
<ul>
<li>相比于Python，Swift是一门更高效，稳定，安全的编程的语言；</li>
<li>Swift更适合应用到移动应用场景。Swift是iOS的官方变成语言；</li>
<li>Swift对于自动微分操作支持非常好，因此非常适合数值计算【~参见上面的@differentiable】；</li>
<li>Swift背后有Google，Apple和FastAI的支持</li>
</ul>
<p>下面这个视频是Jeremy Howard谈论Swift的优势的视频。</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/drSpCwDFwnM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<h2 id="swift-basic-for-data-analysis">Swift Basic for Data Analysis</h2>
<p>在我们开始将Swift应用于数据科学研究之前，我们先来学习一下Swift语言的基础只是。</p>
<h3 id="swift生态">Swift生态</h3>
<p>目前Swift的数据科学应用生态主要由两个生态系统组成：</p>
<ol type="1">
<li>开源生态</li>
<li>苹果生态</li>
</ol>
<p><img src="https://imgs.codewoody.com/uploads/big/8f315354975c79b64987964329b23705.png"></p>
<p>在开源生态系统中，我们可以在任何操作系统下载并运行swift。我们可以使用一些非常酷的Swift库来构建机器学习应用，例如Swift for Tensorflow, SwiftAI以及SwiftPlot.</p>
<p>Swift也能让我们无缝地从Python中引入成熟的数据科学库，例如Numpy, pandas, matplotlib以及scikit-learn。所以如果你之前还在担心从Python迁移到Swift上有任何无法逾越的障碍的话，现在你可以宽心了。</p>
<p>另一方面，苹果公司的生态系统也有其优势。苹果公司提供了一些有用的库，如CoreML，让我们能够在Python中训练大型的模型并且直接导入到Swift中应用。另外，其中还包括了一些已经提前训练好了的成熟模型，我们可以直接在iOS和macOS应用中使用。</p>
<p><img src="https://imgs.codewoody.com/uploads/big/36f6165e5e466fe6807e0f869064b38c.png"></p>
<p>还有一些其他的有意思的库，比如Swift-CoreML-Transformers，可以让我们在iPhone上使用业界最新的文字生成模型，例如GPT-2, BERT等。</p>
<blockquote>
<p><i>There are multiple differences between the two ecosystems. But the most important one is that in order to use the Apple ecosystem, you need to have an Apple machine to work on and you can only build for Apple devices like the iOS, macOS etc.</i></p>
</blockquote>
<p>现在你对Swift有了一个宏观的了解了，下面我们来走进代码。</p>
<h3 id="准备swift环境">准备Swift环境</h3>
<p>在Google Colab【~Colaboratory 是一个免费的 Jupyter 笔记本环境，不需要进行任何设置就可以使用，并且完全在云端运行】上提供了支持GPU和TPU的Swift版本，这里我们直接使用这一服务，从而省去安装过程。</p>
<p><img src="https://imgs.codewoody.com/uploads/big/451eba98fbef8b87bf2473971390e66f.png" alt style="width: 60%"></p>
<p>你可以遵循下面的步骤创建一个启用了Colab notebook。</p>
<ol type="1">
<li>打开一个<a href="https://www.analyticsvidhya.com/blog/2019/10/comprehensive-guide-learn-swift-from-scratch-data-science/" target="_blank" rel="noopener">空白的Swift notebook</a>;</li>
<li>点击"File"，然后选择"Save a copy in Drive" - 这会将Swift notebook保存到你的Google Drive里面。</li>
<li>到这里我们就可以在Colab里面使用Swift了。我们来写下第一行代码：</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"hello world from Swift"</span>)</span><br></pre></td></tr></table></figure>
<p>这就是Swift的hello world程序了！接下来如果你想在本地运行Swift，你可以按照如下的链接进行操作：</p>
<ol type="1">
<li>Swift安装指南：<a href="https://www.analyticsvidhya.com/blog/2019/10/comprehensive-guide-learn-swift-from-scratch-data-science/" target="_blank" rel="noopener">install instructions</a>；</li>
<li>要在Ubuntu中安装Jupyter Notebook：[Jeremy Howard's instructions to install Swift]；</li>
<li>在Ubuntu上也可以使用Docker来安装Swift：<a href="https://github.com/apple/swift-docker" target="_blank" rel="noopener">Swift for Docker</a></li>
</ol>
<blockquote>
<p>如果在macOS下面，直接从应用商店安装xcode就行，可以创建一个Swift Playground来试试Swift语言的特性。我记得iPad上也有Swift Playground的应用。</p>
</blockquote>
<p>接下来让我们快速过一下Swift的基本语言特性。</p>
<h3 id="the-print-function">The Print function</h3>
<p>hello world程序中，<code>print</code>函数的形式一点都不陌生啦。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"Swift is easy to learn!"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="variable-in-swift">Variable in Swift</h3>
<p>Swift提供了两个创建变量的选项：<code>let</code>和<code>var</code>。其中<code>let</code>被用来创建常量，常量的值在其声明周期中是不能被改变的。<code>var</code>用来创建变量，这意味着类似在Python里一样，你可以修改变量的值。</p>
<p>我们来看下面的例子。创建两个变量：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">"Analytics"</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="string">"Vidhya"</span></span><br></pre></td></tr></table></figure>
<p>让我们来尝试修改其值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="string">"AV"</span></span><br><span class="line">a = <span class="string">"AV"</span></span><br></pre></td></tr></table></figure>
<p>我们可以看到修改a的值时会出现错误：</p>
<figure>
<img src="https://imgs.codewoody.com/uploads/big/38eccdfe56ca3db57c311b890bf47df7.png" alt><figcaption>Colab上的截图</figcaption>
</figure>
<p>这种支持创建<strong>常量</strong>的能力可以帮助我们消除很多潜在bug。后面你可以看到我们会用<code>let</code>来创建那些非常重要且我们不希望修改的值。例如训练数据和结果我们会用<code>let</code>来创建，而一些临时变量会使用<code>var</code>来创建。</p>
<p>Swift的另一个很酷的特性是你可以使用emoji来作为变量名【~其实就是对Unicode的支持】</p>
<p><img src="https://imgs.codewoody.com/uploads/big/a7703331c5c85017c96ec42db8c30ac3.png"></p>
<p>我们也可以使用希腊字母来作为变量名称:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> π = <span class="number">3.1415925</span></span><br></pre></td></tr></table></figure>
<h3 id="swift数据类型">Swift数据类型</h3>
<p>Swift支持一些通用的类型，如整型，字符串，单精度浮点数(Float)和双精度浮点数(Double)。在创建变量时，Swift会根据初始化值自动推断变量的类型。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> marks = <span class="number">63</span></span><br><span class="line"><span class="keyword">let</span> percentage = <span class="number">70.0</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">"Sushil"</span></span><br></pre></td></tr></table></figure>
<p>在创建变量时你也可以显式的声明变量类型。如果初始化值和声明的类型不同，Swift会抛出错误。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> weight: <span class="type">Double</span> = <span class="number">62.8</span></span><br></pre></td></tr></table></figure>
<p>字符串格式化的方式在Swift中非常简洁。只需要用反斜杠<code>\</code>后面跟上括号就可以了：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> no_of_apples = <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"I have \(no_of_apples) apples"</span>)</span><br></pre></td></tr></table></figure>
<p>你可以使用连续的三个双引号<code>"""</code>来创建多行字符串。</p>
<h3 id="列表和字典list-and-dictionaries">列表和字典(List and Dictionaries)</h3>
<p>如同Python里面一样，Swift里面也支持List和Dictionary数据结构。不同于Python，在Swift中这两种类型都使用方括号<code>[]</code>。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shoppingList = [<span class="string">"catfish"</span>, <span class="string">"water"</span>, <span class="string">"tulip"</span>, <span class="string">"blue paint"</span>]</span><br><span class="line">shoppingList[<span class="number">1</span>] = <span class="string">"bottle of water"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> occupationsDist = [</span><br><span class="line">  <span class="string">"Malcolm"</span>: <span class="string">"Caption"</span>,</span><br><span class="line">  <span class="string">"Kaylee"</span>: <span class="string">"Mechanic"</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ccupationsDict[<span class="string">"Jayne"</span>] = <span class="string">"Public Relations"</span></span><br></pre></td></tr></table></figure>
<h3 id="循环">循环</h3>
<p>除了支持经典的循环之外，Swift有一些自定义的比较独特的循环形式：</p>
<h4 id="for...in-loop">for...in loop</h4>
<p>类似Python的写法，在Swift中，你可以以如下形式来遍历列表Lists或者ranges</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>...<span class="number">5</span> &#123;</span><br><span class="line">  <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> someList = [<span class="number">20</span>, <span class="number">30</span>, <span class="number">10</span>, <span class="number">40</span>]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> someList &#123;</span><br><span class="line">  <span class="built_in">print</span>(item * <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的连续三个点的符号用来创建ranges。<code>...</code>创建的两侧是闭集， 如果要创建不包含最右侧的变量的范围，使用<code>..&lt;</code>符号即可。</p>
<blockquote>
<p>注意Swift使用花括号，而非缩进形式来表示代码层次结构</p>
</blockquote>
<p>在Swift中也可以使用比较经典的while和for循环。<a href="https://docs.swift.org/swift-book/LanguageGuide/ControlFlow.html" target="_blank" rel="noopener">You can learn more about loops in Swift here</a></p>
<h3 id="条件">条件</h3>
<p>这里就是非常经典的if语句了，不做赘述。</p>
<blockquote>
<p>Swift中条件语句针对Optional类型做了专门的优化。</p>
</blockquote>
<h3 id="函数">函数</h3>
<p>下图是Swift函数的定义形式</p>
<p><img src="https://imgs.codewoody.com/uploads/big/ab6365a6d34703b1ef7dd5c72d67e200.png"></p>
<h3 id="代码中的注释">代码中的注释</h3>
<p>Swift中的注释形式和C/C++比较像：用<code>//</code>来开始行注释，用<code>/* ... */</code>来常见块注释。在代码中多写注释是一个好习惯。</p>
<h3 id="在swift中使用python的库">在Swift中使用Python的库</h3>
<p>Swift支持和Python的互操作，这意味着你可以直接在Swift中使用大部分Python库：调用函数或者做变量的类型转换。这个特性大大增强了Swift的功能。尽管Swift的生态还非常年轻，但是我们可以直接使用非常成熟的Python库，如Numpy，Pandas还有Matplotlib等。</p>
<p>为了引用Python模块，我们只需要将Swift的<code>Python</code>模块导入，然后使用这个模块的接口即可：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Python</span><br><span class="line"></span><br><span class="line"><span class="comment">// Load numpy from python</span></span><br><span class="line"><span class="keyword">let</span> np = <span class="type">Python</span>.<span class="keyword">import</span>("numpy")</span><br><span class="line"></span><br><span class="line"><span class="comment">// create array of zeros</span></span><br><span class="line"><span class="keyword">var</span> zeros = np.ones([<span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(zeros)</span><br></pre></td></tr></table></figure>
<p>matplotlib库也可以直接导入：</p>
<p><img src="https://imgs.codewoody.com/uploads/big/9223622e676db4d5e4cb7b29029d2b2c.png"></p>
<h2 id="在swift中使用tensorflow创建一个基础模型">在Swift中使用Tensorflow创建一个基础模型</h2>
<p><img src="https://imgs.codewoody.com/uploads/big/d0bfb4405b609c516a0496dcf9d5d6fb.png"></p>
<p>Swift4Tensorflow是Swift生态中一个非常成熟的库。我们可以用非常类似Keras的方式来创建机器学习和深度学习的模块。</p>
<p>有意思的是，Swift4Tensorflow不只是一个简单的Tensorflow的Swift语言打包，而是根据Swift本身语言开发的库。未来这个库可能会变成Swift的语言的核心部分。</p>
<blockquote>
<p><i>What this means is that the amazing set of Engineers from Apple’s Swift team and Google’s Tensorflow team will make sure that you are able to do high-performance machine learning in Swift.</i></p>
</blockquote>
<p>这个库加入了一些Swift语言的有用特性，如自动微分支持（这让我想起了PyTorch中的Autogrid）。</p>
<p><img src="https://imgs.codewoody.com/uploads/big/b0ca21f0935f746d295e396801745a8d.png"></p>
<h3 id="关于数据集">关于数据集</h3>
<p>首先让我们来解释一下这个section的问题。如果你之前接触过深度学习领域，你应该比较熟悉了。</p>
<p>我们将会建立一个卷积神经网络(CNN)模型来将MNIST数据集中的图片识别为数字字符。MNIST数据集包括60,000个训练图像和10,000个测试图像。图像为手写的数字字符。</p>
<p><img src="https://imgs.codewoody.com/uploads/big/8eb4727e890c2a4a24e5bacff634c764.png"></p>
<p>这个数据集是研究计算机视觉的时候一个非常常用的数据集，所以我在这里不做细节性的描述。要了解更多，你可以读一下<a href="https://en.wikipedia.org/wiki/MNIST_database" target="_blank" rel="noopener">这个</a>。</p>
<h3 id="配置羡慕">配置羡慕</h3>
<p>在我们开始创建模块之前。我们需要下载数据集并进行预处理。为了你的方便我已经创建了一个Github仓库，提供了预处理代码以及数据。让我们下载配置代码，下载数据集并导入黑色的库。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">%include <span class="string">"EnableIPythonDisplay.swift"</span></span><br><span class="line"><span class="type">IPythonDisplay</span>.shell.enable_matplotlib(<span class="string">"inline"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> Python</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> os = <span class="type">Python</span>.<span class="keyword">import</span>("os")</span><br><span class="line"><span class="keyword">let</span> plt = <span class="type">Python</span>.<span class="keyword">import</span>("matplotlib.pyplot")</span><br><span class="line"></span><br><span class="line">os.system(<span class="string">"git clone https://github.com/mohdsanadzakirizvi/swift-datascience.git"</span>)</span><br><span class="line">os.chdir(<span class="string">"/content/swift-datascience"</span>)</span><br></pre></td></tr></table></figure>
<p>运行上面的代码，数据集就会下载到Colab的环境中了。</p>
<blockquote>
<p>在本地运行时代码应该需要修改，这个我们后面来讨论</p>
<p>不过这个操作太丑陋了，没有使用Swift的native方法来调用shell命令。</p>
</blockquote>
<h3 id="载入数据">载入数据</h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%include <span class="string">"/content/swift-datascience/MNIST.swift"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Load dataset</span></span><br><span class="line"><span class="keyword">let</span> dataset = <span class="type">MNIST</span>(batchSize: <span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get first 5 images</span></span><br><span class="line"><span class="keyword">let</span> imgs = dataset.trainingImages.minibatch(at: <span class="number">0</span>, batchSize: <span class="number">5</span>).makeNumpyArray()</span><br><span class="line"><span class="built_in">print</span>(imgs.shape)</span><br></pre></td></tr></table></figure>
<h3 id="查看一下数据集">查看一下数据集</h3>
<p>我们尝试画出数据集中的图片来看看我们要处理的问题：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="type">Display</span> first <span class="number">5</span> images</span><br><span class="line"><span class="keyword">for</span> img <span class="keyword">in</span> imgs&#123;</span><br><span class="line">  plt.imshow(img.reshape(<span class="number">28</span>,<span class="number">28</span>))</span><br><span class="line">  plt.show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>画出来大概是下面的样子：</p>
<p><img src="https://imgs.codewoody.com/uploads/big/4505b19dc02e603f5e155e899b4073a7.png"></p>
<h3 id="定义模型结构">定义模型结构</h3>
<p>现在让我们来定义我们的模型的结构。这里我使用了LeNet-5架构，一个非常基础的CNN模型，包含两个卷基层，average pooling还有三个Dense层【~应该是全连接层？】。最后一级dense layer的输出维数是10，因为我们有10个类别要输出，分别代表0-9.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> TensorFlow</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> epochCount = <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> batchSize = <span class="number">128</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The LeNet-5 model</span></span><br><span class="line"><span class="keyword">var</span> classifier = <span class="type">Sequential</span> &#123;</span><br><span class="line">    <span class="type">Conv2D</span>&lt;<span class="type">Float</span>&gt;(filterShape: (<span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">6</span>), padding: .same, activation: relu)</span><br><span class="line">    <span class="type">AvgPool2D</span>&lt;<span class="type">Float</span>&gt;(poolSize: (<span class="number">2</span>, <span class="number">2</span>), strides: (<span class="number">2</span>, <span class="number">2</span>))</span><br><span class="line">    <span class="type">Conv2D</span>&lt;<span class="type">Float</span>&gt;(filterShape: (<span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">16</span>), activation: relu)</span><br><span class="line">    <span class="type">AvgPool2D</span>&lt;<span class="type">Float</span>&gt;(poolSize: (<span class="number">2</span>, <span class="number">2</span>), strides: (<span class="number">2</span>, <span class="number">2</span>))</span><br><span class="line">    <span class="type">Flatten</span>&lt;<span class="type">Float</span>&gt;()</span><br><span class="line">    <span class="type">Dense</span>&lt;<span class="type">Float</span>&gt;(inputSize: <span class="number">400</span>, outputSize: <span class="number">120</span>, activation: relu)</span><br><span class="line">    <span class="type">Dense</span>&lt;<span class="type">Float</span>&gt;(inputSize: <span class="number">120</span>, outputSize: <span class="number">84</span>, activation: relu)</span><br><span class="line">    <span class="type">Dense</span>&lt;<span class="type">Float</span>&gt;(inputSize: <span class="number">84</span>, outputSize: <span class="number">10</span>, activation: softmax)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可能已经注意到了，上面的代码和你在Keras（或者PyTorch，TensorFlow）中写的Python代码非常类似</p>
<blockquote>
<p><i>The simplicity of writing code is one of the biggest points of Swift.</i></p>
</blockquote>
<p>Swift4Tensorflow支持很多现成的多层模型。更多阅读参考：<a href="https://www.tensorflow.org/swift/api_docs/Structs" target="_blank" rel="noopener">https://www.tensorflow.org/swift/api_docs/Structs</a></p>
<h3 id="选择梯度下降作为optimizer">选择梯度下降作为Optimizer</h3>
<p>类似的，这里我们也需要选择Optimizer来优化我们的模型。我们这里选择使用随机梯度下降算法(stochastic gradient descent, SGD)。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> optimizer = <span class="type">SGD</span>(<span class="keyword">for</span>: classifier, learningRate: <span class="number">0.1</span>)</span><br></pre></td></tr></table></figure>
<p>Swift4Tensorflow还支持很多Optimizer：</p>
<ul>
<li>AMSGrad</li>
<li>AdaDelta</li>
<li>AdaGrad</li>
<li>AdaMax</li>
<li>Adam</li>
<li>Parameter</li>
<li>RMSProp</li>
<li>SGD</li>
</ul>
<h3 id="模型训练">模型训练</h3>
<p>现在万事俱备了，让我们开始训练模型吧。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"Beginning training..."</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Statistics</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> correctGuessCount: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> totalGuessCount: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> totalLoss: <span class="type">Float</span> = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Store accuracy results during training</span></span><br><span class="line"><span class="keyword">var</span> trainAccuracyResults: [<span class="type">Float</span>] = []</span><br><span class="line"><span class="keyword">var</span> testAccuracyResults: [<span class="type">Float</span>] = []</span><br><span class="line"></span><br><span class="line"><span class="comment">// The training loop.</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="number">1</span>...epochCount &#123;</span><br><span class="line">    <span class="keyword">var</span> trainStats = <span class="type">Statistics</span>()</span><br><span class="line">    <span class="keyword">var</span> testStats = <span class="type">Statistics</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set context to training </span></span><br><span class="line">    <span class="type">Context</span>.local.learningPhase = .training</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span> ..&lt; dataset.trainingSize / batchSize &#123;</span><br><span class="line">        <span class="comment">// Get mini-batches of x and y</span></span><br><span class="line">        <span class="keyword">let</span> x = dataset.trainingImages.minibatch(at: i, batchSize: batchSize)</span><br><span class="line">        <span class="keyword">let</span> y = dataset.trainingLabels.minibatch(at: i, batchSize: batchSize)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Compute the gradient with respect to the model.</span></span><br><span class="line">        <span class="keyword">let</span> 𝛁model = classifier.gradient &#123; classifier -&gt; <span class="type">Tensor</span>&lt;<span class="type">Float</span>&gt; <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> ŷ = classifier(x)</span><br><span class="line">            <span class="keyword">let</span> correctPredictions = ŷ.argmax(squeezingAxis: <span class="number">1</span>) .== y</span><br><span class="line">            </span><br><span class="line">            trainStats.correctGuessCount += <span class="type">Int</span>(<span class="type">Tensor</span>&lt;<span class="type">Int32</span>&gt;(correctPredictions).sum().scalarized())</span><br><span class="line">            trainStats.totalGuessCount += batchSize</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> loss = softmaxCrossEntropy(logits: ŷ, labels: y)</span><br><span class="line">            trainStats.totalLoss += loss.scalarized()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> loss</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Update the model's differentiable variables along the gradient vector.</span></span><br><span class="line">        optimizer.update(&amp;classifier, along: 𝛁model)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set context to inference</span></span><br><span class="line">    <span class="type">Context</span>.local.learningPhase = .inference</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span> ..&lt; dataset.testSize / batchSize &#123;</span><br><span class="line">        <span class="keyword">let</span> x = dataset.testImages.minibatch(at: i, batchSize: batchSize)</span><br><span class="line">        <span class="keyword">let</span> y = dataset.testLabels.minibatch(at: i, batchSize: batchSize)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Compute loss on test set</span></span><br><span class="line">        <span class="keyword">let</span> ŷ = classifier(x)</span><br><span class="line">        <span class="keyword">let</span> correctPredictions = ŷ.argmax(squeezingAxis: <span class="number">1</span>) .== y</span><br><span class="line"></span><br><span class="line">        testStats.correctGuessCount += <span class="type">Int</span>(<span class="type">Tensor</span>&lt;<span class="type">Int32</span>&gt;(correctPredictions).sum().scalarized())</span><br><span class="line">        testStats.totalGuessCount += batchSize</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> loss = softmaxCrossEntropy(logits: ŷ, labels: y)</span><br><span class="line"></span><br><span class="line">        testStats.totalLoss += loss.scalarized()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> trainAccuracy = <span class="type">Float</span>(trainStats.correctGuessCount) / <span class="type">Float</span>(trainStats.totalGuessCount)</span><br><span class="line">    <span class="keyword">let</span> testAccuracy = <span class="type">Float</span>(testStats.correctGuessCount) / <span class="type">Float</span>(testStats.totalGuessCount)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save train and test accuracy</span></span><br><span class="line">    trainAccuracyResults.append(trainAccuracy)</span><br><span class="line">    testAccuracyResults.append(testAccuracy)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"""</span></span><br><span class="line"><span class="string">          [Epoch \(epoch)] \</span></span><br><span class="line"><span class="string">          Training Loss: \(trainStats.totalLoss), \</span></span><br><span class="line"><span class="string">          Training Accuracy: \(trainStats.correctGuessCount)/\(trainStats.totalGuessCount) \</span></span><br><span class="line"><span class="string">          (\(trainAccuracy)), \</span></span><br><span class="line"><span class="string">          Test Loss: \(testStats.totalLoss), \</span></span><br><span class="line"><span class="string">          Test Accuracy: \(testStats.correctGuessCount)/\(testStats.totalGuessCount) \</span></span><br><span class="line"><span class="string">          (\(testAccuracy))</span></span><br><span class="line"><span class="string">          """</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面的代码中用了一些fancy的数学符号，但是由于这些符号输入并不方便，因此实际编程中我们不会这么做。</p>
</blockquote>
<p>上面的代码流程中我们将数据集的样本传递给模型，帮助其改善预测精度。训练步骤如下：</p>
<ol type="1">
<li>训练重复若干次，每次我们遍历整个训练集。</li>
<li>在每次训练迭代中，我们逐个传入features(<code>x</code>)和labels(<code>y</code>)，这对下一步非常重要。</li>
<li>使用样本的features，使用模型做出预测，并与labels提供的真值进行比对，进而计算出模型的损失函数和下降梯度方向。</li>
<li>这是梯度下降算法发挥了作用，我们沿着梯度方向更新模型的变量。</li>
<li>追踪训练过程中的一些统计数据来方便我们后续做可视化。</li>
<li>在第一步提到的重复训练中，每次重复2至5步。</li>
</ol>
<p><code>epochCount</code>变量为重复遍历数据集的次数。你可以修改其值尝试一下。</p>
<p>需要多少次遍历来取得90%以上的正确率呢？我可以在12次训练下在训练集和测试集上获得97%以上的正确率。</p>
<p><img src="https://imgs.codewoody.com/uploads/big/5b367d407d32802ecce0bcd33b3e9f9a.png" alt style="border: none;"></p>
<h3 id="可视化输出训练过程">可视化输出训练过程</h3>
<p>用下面的方法我么可以可视化输出训练过程中的误差演变过程：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize: [<span class="number">12</span>, <span class="number">8</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> accuracyAxes = plt.subplot(<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">accuracyAxes.set_ylabel(<span class="string">"Train Accuracy"</span>)</span><br><span class="line">accuracyAxes.plot(trainAccuracyResults, color: <span class="string">"blue"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> lossAxes = plt.subplot(<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">lossAxes.set_ylabel(<span class="string">"Test Accuracy"</span>)</span><br><span class="line">lossAxes.set_xlabel(<span class="string">"Epoch"</span>)</span><br><span class="line">lossAxes.plot(testAccuracyResults, color: <span class="string">"yellow"</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>得到的结果如下图所示：</p>
<p><img src="https://imgs.codewoody.com/uploads/big/0db98a3b3315f281946c68ec3ad9cf57.png"></p>
<h2 id="swift数据科学应用的未来">Swift数据科学应用的未来</h2>
<p>有产业专家对Swift做出了很高的评价，认为其有潜力成为数据科学的主流语言，同时也能成为机器学习类应用开发的主要工具。</p>
<p>目前，很多fancy的数据科学相关的Swift库还在开发中，其背后有强大的业界支持。我非常看好Swift生态的未来--甚至会比现在的Python更加强大。</p>
<p>下面是一些你可以进一步研究的Swift库：</p>
<ul>
<li><a href="https://github.com/nifty-swift/Nifty-demo" target="_blank" rel="noopener">Nifty(Demo)</a>: Swift的通用数值就散库</li>
<li><a href="https://github.com/KarthikRIyer/swiftplot" target="_blank" rel="noopener">Swiftplot</a>: Swift的数据可视化库</li>
<li><a href="https://github.com/tensorflow/swift" target="_blank" rel="noopener">Swift for Tensorflow</a>: 下一代的机器学习平台</li>
<li><a href="https://github.com/Swift-AI/Swift-AI" target="_blank" rel="noopener">Swift AI</a>: 基于Swift的高性能深度学习框架</li>
</ul>
<p>本文涉及的所有代码<a href="https://github.com/mohdsanadzakirizvi/swift-datascience" target="_blank" rel="noopener">托管在Github上</a>。</p>
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/46352/" rel="next" title="【翻译】分析恶意SSH访问">
                <i class="fa fa-chevron-left"></i> 【翻译】分析恶意SSH访问
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/38296/" rel="prev" title="[转载]传华为13年老员工离职索要赔偿被关押251天">
                [转载]传华为13年老员工离职索要赔偿被关押251天 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://imgs.codewoody.com/uploads/big/0330eb8242d9bfc4873c11450f0ab691.jpg" alt="治部少辅">
            
              <p class="site-author-name" itemprop="name">治部少辅</p>
              <div class="site-description motion-element" itemprop="description">晚来天雨雪，能饮一杯无？</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">113</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">58</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/huangy10" title="GitHub &rarr; https://github.com/huangy10" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.zhihu.com/people/woody-huang" title="知乎 &rarr; https://www.zhihu.com/people/woody-huang" rel="noopener" target="_blank"><i class="fa fa-fw fa-zhihu"></i>知乎</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.jianshu.com/u/927273827560" title="简书 &rarr; https://www.jianshu.com/u/927273827560" rel="noopener" target="_blank"><i class="fa fa-fw fa-jianshu"></i>简书</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#overview"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">2.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#why-swift"><span class="nav-number">3.</span> <span class="nav-text">Why Swift?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#swift-basic-for-data-analysis"><span class="nav-number">4.</span> <span class="nav-text">Swift Basic for Data Analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#swift生态"><span class="nav-number">4.1.</span> <span class="nav-text">Swift生态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#准备swift环境"><span class="nav-number">4.2.</span> <span class="nav-text">准备Swift环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#the-print-function"><span class="nav-number">4.3.</span> <span class="nav-text">The Print function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#variable-in-swift"><span class="nav-number">4.4.</span> <span class="nav-text">Variable in Swift</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#swift数据类型"><span class="nav-number">4.5.</span> <span class="nav-text">Swift数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#列表和字典list-and-dictionaries"><span class="nav-number">4.6.</span> <span class="nav-text">列表和字典(List and Dictionaries)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#循环"><span class="nav-number">4.7.</span> <span class="nav-text">循环</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#for...in-loop"><span class="nav-number">4.7.1.</span> <span class="nav-text">for...in loop</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件"><span class="nav-number">4.8.</span> <span class="nav-text">条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数"><span class="nav-number">4.9.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代码中的注释"><span class="nav-number">4.10.</span> <span class="nav-text">代码中的注释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在swift中使用python的库"><span class="nav-number">4.11.</span> <span class="nav-text">在Swift中使用Python的库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在swift中使用tensorflow创建一个基础模型"><span class="nav-number">5.</span> <span class="nav-text">在Swift中使用Tensorflow创建一个基础模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#关于数据集"><span class="nav-number">5.1.</span> <span class="nav-text">关于数据集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置羡慕"><span class="nav-number">5.2.</span> <span class="nav-text">配置羡慕</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#载入数据"><span class="nav-number">5.3.</span> <span class="nav-text">载入数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看一下数据集"><span class="nav-number">5.4.</span> <span class="nav-text">查看一下数据集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义模型结构"><span class="nav-number">5.5.</span> <span class="nav-text">定义模型结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#选择梯度下降作为optimizer"><span class="nav-number">5.6.</span> <span class="nav-text">选择梯度下降作为Optimizer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模型训练"><span class="nav-number">5.7.</span> <span class="nav-text">模型训练</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可视化输出训练过程"><span class="nav-number">5.8.</span> <span class="nav-text">可视化输出训练过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#swift数据科学应用的未来"><span class="nav-number">6.</span> <span class="nav-text">Swift数据科学应用的未来</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">治部少辅</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.1.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="Total Visitors">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="Total Views">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>



  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  
  
  <script id="dsq-count-scr" src="https://codewoody.disqus.com/count.js" async></script>


<script>
  var disqus_config = function() {
    this.page.url = "http://www.codewoody.com/posts/37730/";
    this.page.identifier = "posts/37730/";
    this.page.title = '【翻译】使用Swift语言来进行数据科学研究的指南';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://codewoody.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('Copy');
      }, 300);
    }).append(e);
  })
</script>


  

  


  <script src="https://ethantw.github.io/Han/latest/han.min.js"></script>
  
  <script>
    void function(){
      // window.hinst = Han(document.querySelector('.post-body')).setRoutine([
      //   'initCond',
      //   'renderElem',
      //   'renderJiya',
      //   'renderHanging',
      //   'renderHWS',
      //   'correctBasicBD',
      //   'substCombLigaWithPUA'
      // ]).render()
      document.getElementById("refs")
          .setAttribute("lang", "en_US");
    }()

    </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>

<!DOCTYPE html>












  


  


<html class="theme-next pisces use-motion han-js-rendered no-han-space" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






  <!--  -->
  
  
  <link rel="stylesheet" href="https://ethantw.github.io/Han/latest/han.min.css">



  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">














  
  
  
  

  

  

  

  

  

  







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">



  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico?v=7.1.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="前言 二维马尔科夫链是在涉及包含退避过程的DCF机制的最常用模型。这部分理论工作的文章大部分可以追溯到Bianchi在2000年的经典论文[1]。这篇论文在过去近20年里获得了将近一万条引用。这篇文章我们在介绍WAVE协议时详细提到过。 Bianchi的经典论文 引入信道繁忙条件 这部分的内容主要来自[2]。 System Model 沿用了Bianchi的假设条件，包括有限数量的通信节点(\(n">
<meta property="og:type" content="website">
<meta property="og:title" content="二维马尔科夫链的使用">
<meta property="og:url" content="http://www.codewoody.com/knowledge-base/academic/its/wave/markov/2D-markov.html">
<meta property="og:site_name" content="治部少辅">
<meta property="og:description" content="前言 二维马尔科夫链是在涉及包含退避过程的DCF机制的最常用模型。这部分理论工作的文章大部分可以追溯到Bianchi在2000年的经典论文[1]。这篇论文在过去近20年里获得了将近一万条引用。这篇文章我们在介绍WAVE协议时详细提到过。 Bianchi的经典论文 引入信道繁忙条件 这部分的内容主要来自[2]。 System Model 沿用了Bianchi的假设条件，包括有限数量的通信节点(\(n">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/b9caa185947e66233862ca27916c7921.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/f01151f6d7bcba58edda6353bfae5dc8.png">
<meta property="og:image" content="https://imgs.codewoody.com/uploads/big/64a9413662f187b1c9e62ab0fd9ef1d6.png">
<meta property="og:updated_time" content="2020-01-15T08:07:20.713Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="二维马尔科夫链的使用">
<meta name="twitter:description" content="前言 二维马尔科夫链是在涉及包含退避过程的DCF机制的最常用模型。这部分理论工作的文章大部分可以追溯到Bianchi在2000年的经典论文[1]。这篇论文在过去近20年里获得了将近一万条引用。这篇文章我们在介绍WAVE协议时详细提到过。 Bianchi的经典论文 引入信道繁忙条件 这部分的内容主要来自[2]。 System Model 沿用了Bianchi的假设条件，包括有限数量的通信节点(\(n">
<meta name="twitter:image" content="https://imgs.codewoody.com/uploads/big/b9caa185947e66233862ca27916c7921.png">



  <link rel="alternate" href="/atom.xml" title="治部少辅" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://www.codewoody.com/knowledge-base/academic/its/wave/markov/2D-markov">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>二维马尔科夫链的使用 | 治部少辅</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-114736006-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-114736006-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">治部少辅</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">大一大万大吉</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-knowledge menu-item-active">

    
    
    
      
    

    

    <a href="/knowledge-base" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i> <br>knowledge</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-weekly">

    
    
    
      
    

    

    <a href="/categories/Weekly/" rel="section"><i class="menu-item-icon fa fa-fw fa-newspaper-o"></i> <br>weekly</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-updates">

    
    
    
      
    

    

    <a href="/update" rel="section"><i class="menu-item-icon fa fa-fw fa-edit"></i> <br>updates</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-channel">

    
    
    
      
    

    

    <a href="https://t.me/everthingaboutbullshit" rel="noopener" target="_blank"><i class="menu-item-icon fa fa-fw fa-signal"></i> <br>channel</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/huangy10" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

    
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
    

  


          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

<h2 class="post-title" itemprop="name headline">二维马尔科夫链的使用

</h2>

<div class="post-meta">
  
  


  
  
  <ul class="breadcrumb">
    
      
      
        
          
            
          
          
            <li><a href="/knowledge-base/">KNOWLEDGE-BASE</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li><a href="/knowledge-base/academic/">ACADEMIC</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li><a href="/knowledge-base/academic/its/">ITS</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li><a href="/knowledge-base/academic/its/wave/">WAVE</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li><a href="/knowledge-base/academic/its/wave/markov/">MARKOV</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li>2D-MARKOV</li>
          
        
      
    
  </ul>


</div>

</header>

      
      
      
      <div class="post-body han-init-context">
        
        
          <h2 id="前言">前言</h2>
<p>二维马尔科夫链是在涉及包含退避过程的DCF机制的最常用模型。这部分理论工作的文章大部分可以追溯到Bianchi在2000年的经典论文<span class="citation" data-cites="bianchi2000performance">[1]</span>。这篇论文在过去近20年里获得了将近一万条引用。这篇文章我们在介绍<a href="/knowledge-base/academic/its/wave/wave.html">WAVE协议</a>时详细提到过。</p>
<h2 id="bianchi的经典论文">Bianchi的经典论文</h2>
<h2 id="引入信道繁忙条件">引入信道繁忙条件</h2>
<p>这部分的内容主要来自<span class="citation" data-cites="eustathia2002csma">[2]</span>。</p>
<h3 id="system-model">System Model</h3>
<p>沿用了Bianchi的假设条件，包括有限数量的通信节点(<span class="math inline">\(n\)</span>个)以及理想信道条件。这篇文章中研究的是饱和条件下的稳态性能。饱和条件意味着对于每个节点，当其完成一次传输时，立刻就有一个新的包等待传输。</p>
<p>文章采用的DCF机制是经典的DCF机制，核心特点包括指数增长的退避窗口，在退避期间信道繁忙时，退避计数器的值冻结。退避窗口到达最大以后，停止增长。若发送失败，则窗口保持最大值。反之，如果发送成功，则重置退避窗口。</p>
<p>随机变量的定义则如下：<span class="math inline">\(b(t)\)</span>定义为在t时隙上的退避计数器取值。每个节点退避窗口的定义为 <span class="math display">\[\begin{equation}
\begin{array}{l}
W_{\min} = W \\
W_{\max} = 2^{m} W
\end{array}
\end{equation}\]</span> 即共有<span class="math inline">\(m+1\)</span>个退避阶段(backoff stage)。<span class="math inline">\(s(t)\)</span>为用来表示退避阶段的随机变量。那么二元随机过程<span class="math inline">\(\{s(t), b(t)\}\)</span>构成二维离散马尔科夫链。记条件碰撞概率为<span class="math inline">\(p\)</span>，信道繁忙概率为<span class="math inline">\(p_b\)</span>。假定<span class="math inline">\(p\)</span>与<span class="math inline">\(p_b\)</span>与退避过程无关。当<span class="math inline">\(W\)</span>和<span class="math inline">\(n\)</span>比较大时此假设更加准确。</p>
<p>二元随机过程<span class="math inline">\(\{s(t), b(t)\}\)</span>的状态值记为<span class="math inline">\(\{i, k\}\)</span>。其中<span class="math inline">\(0 \leq i \leq m, 0 \leq k \leq W_i - 1\)</span>, 其中<span class="math inline">\(W_i = 2^i W\)</span>。模型中还存在另一个状态<span class="math inline">\(\{-1, 0\}\)</span>。这个状态代表当退避计数器为0，且经过DIFS时间后信道空闲时，节点会在当前时隙立即发送数据。<span class="math inline">\(\{-1, 0\}\)</span>这个状态刻画了此行为。这个状态未在Bianchi的模型中引入。</p>
<p>概率转移图如下：</p>
<p><img src="https://imgs.codewoody.com/uploads/big/b9caa185947e66233862ca27916c7921.png"></p>
<p>转移概率为：</p>
<p><span class="math display">\[\begin{equation}
\left\{
  \begin{array}{ll}
  P\{-1, 0 | -1, 0\} = (1 - p) (1 - p_b) \\
  P\{0, k | -1, 0\} = \frac{(1 - p)p_b + p}{W_0}, &amp; 0 \leq k \leq W_0 - 1 \\
  P\{i, k | i, k\} = p_b, &amp; 1 \leq k \leq W_i - 1 \quad 0 \leq i \leq m \\
  P\{i, k | i, k + 1\} = 1 - p_b, &amp; 1 \leq k \leq W_i - 2 \quad 0 \leq i \leq m \\
  P\{0, k | i, 0\} = \frac{(1 - p)p_b}{W_0}, &amp; 0 \leq k \leq W_i - 1 \quad 0 \leq i \leq m \\
  P\{-1, 0 | i, 0\} = (1 - p)(1 - p_b), &amp; 0 \leq i \leq m \\
  P\{i, k |  i - 1, 0\} = \frac{p}{W_i}, &amp; 1 \leq k \leq W_i - 1 \quad 0 \leq i \leq m \\
  P\{m, k | m, 0\} = \frac{p}{W_m}, &amp; 0 \leq k \leq W_m = 1
  \end{array}
\right.
\end{equation}\]</span></p>
<p>其中：</p>
<ol type="1">
<li>第一项指经过前一个成功的发送之后又观察到信道空闲并立刻发送当前数据包；</li>
<li>第二项指经过前一个成功的发送之后发送当前数据包时发现信道繁忙或者发送产生了碰撞，从而进入退避状态；</li>
<li>第三项表示在退避计数器递减过程中发现信道繁忙，故冻结计数器值；</li>
<li>第四项表示退避计数器在空闲信道下递减；</li>
<li>第五项表示退避计数器到0之后，当前包发送成功，但是发现发送下一个数据包时信道繁忙；</li>
<li>第六项表示退避计数器到0之后，当前包发送成功且被成功接收，且检测到信道空闲。</li>
<li>第七项表示退避计数器到0之后传输失败，增加退避窗口；</li>
<li>第八项表示达到了最大退避窗口后，传输失败，但是退避窗口不再增加。</li>
</ol>
<p>接下来我们需要计算稳态概率分布。记平稳分布为<span class="math inline">\(b_{i, k} = \lim_{t\rightarrow \infty} P\{s(t) = i, b(t) = k\}\)</span>。对于平稳分布我们有如下的关系： <span class="math display">\[\begin{equation}
b_{i, 0}=p^{i} b_{0,0} 0 \leq i \leq m-1
\end{equation}\]</span> <span class="math display">\[\begin{equation}
b_{m, 0}=\frac{p^{m}}{1-p} b_{0,0}
\end{equation}\]</span> <span class="math display">\[\begin{equation}
b_{i, k}=\frac{W_{i}-k}{W_{i}} \frac{1}{1-p_{b}} b_{i, 0} \quad 0 \leq i \leq m 1 \leq k \leq W_{i}-1
\end{equation}\]</span> <span class="math display">\[\begin{equation}
b_{0,0}=\frac{p_{b}+p\left(1-p_{b}\right)}{1-p_{b}} b_{-1,0}
\end{equation}\]</span></p>
<p>然后使用正则化条件</p>
<p><span class="math display">\[\begin{equation}
b_{-1,0}+\sum_{i=0}^{m} \sum_{k=0}^{W_{i}-1} b_{i, k}=1
\end{equation}\]</span></p>
<p>经过推导可以得到</p>
<p><span class="math display">\[\begin{equation}
b_{-1,0}=\frac{2\left(1-p_{b}\right)^{2}(1-2 p)(1-p)}{2\left(1-p_{b}\right)^{2}(1-2 p)(1-p)+\left(p_{b}+p\left(1-p_{b}\right)\right)(1-2 p)(W+1)+p W\left(p_{b}+p\left(1-p_{b}\right)\right)\left(1-(2 p)^{m}\right)}
\end{equation}\]</span></p>
<p>已知平稳分布以后，我们可以计算对于某个节点任意时隙的传输概率</p>
<p><span class="math display">\[\begin{equation}
\tau=\sum_{i=-1}^{m} b_{i, 0}=b_{-1,0}+\sum_{i=0}^{m-1} b_{i, 0}+b_{m, 0}
\end{equation}\]</span></p>
<blockquote>
<p>当退避计数器到0时，节点即会尝试发送数据包。</p>
</blockquote>
<p>这个公式全部展开也非常长，不过也是简单的多项式计算</p>
<p><span class="math display">\[\begin{equation}
\label{eq:transmission_prob}
\tau=\frac{2\left(1-p_{b}\right)(1-2 p)}{2\left(1-p_{b}\right)^{2}(1-2 p)(1-p)+\left(p_{b}+p\left(1-p_{b}\right)(1-2 p)(W+1)+p W\left(p_{b}+p\left(1-p_{b}\right)\right)\left(1-(2 p)^{m}\right)\right.}
\end{equation}\]</span></p>
<p>进而得到碰撞概率为 <span class="math display">\[\begin{equation}
\label{eq:collision_prob}
p=1-(1-\tau)^{n-1}
\end{equation}\]</span></p>
<p>信道繁忙的概率为</p>
<p><span class="math display">\[\begin{equation}
\label{eq:medium_busy_prob}
p_{b}=1-(1-\tau)^{n}
\end{equation}\]</span></p>
<p>将<span class="math inline">\(\eqref{eq:collision_prob}\)</span>及<span class="math inline">\(\eqref{eq:medium_busy_prob}\)</span>代入<span class="math inline">\(\eqref{eq:transmission_prob}\)</span>可以得到关于<span class="math inline">\(\tau\)</span>的非线性方程。此方程可以通过数值方法求解。</p>
<h3 id="性能分析">性能分析</h3>
<p>类似Bianchi的做法，这里认为对于每一次传输，无论成功与非，都视为一个<strong>更新过程</strong>。因此，可以计算相邻两次传输之间的CSMA/CA协议的吞吐率。此时吞吐率<span class="math inline">\(S\)</span>可以表达为:</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
S &amp;=\frac{E[\text { time used for successful transmission in an interval }]}{E[\text { length between two consecutive transmissions }]} \\
&amp;=\frac{P_{s} E[P]}{E[\Psi]+P_{s} T_{s}+\left(1-P_{s}\right) T_{c}} 
\end{aligned}
\label{eq:throughput}
\end{equation}\]</span></p>
<p>其中，<span class="math inline">\(E[P]\)</span>为Payload的平均大小。<span class="math inline">\(T_s\)</span>为成功传输的平均时间，<span class="math inline">\(T_c\)</span>为冲突的平均持续时间。<span class="math inline">\(P_s\)</span>为传输成功的概率。而<span class="math inline">\(E[\Psi]\)</span>则表示在传输发生之前由于退避引入的空余时隙的长度。一般我们假定包的大小都是相同的，即<span class="math inline">\(E[P] = P\)</span>。<span class="math inline">\(T_s\)</span>和<span class="math inline">\(T_c\)</span>的值取决于具体的DCF机制：</p>
<p><span class="math display">\[\begin{equation}
\begin{array}{l}{T_{\mathrm{s}}^{\mathrm{ack}}=H+P+\delta+\mathrm{SIFS}+\mathrm{ACK}+\delta+\mathrm{DIFS}} \\ {T_{\mathrm{c}}^{\mathrm{ack}}=H+P+\delta+\mathrm{DIFS}}\end{array} \} ACK CSMA/CA
\end{equation}\]</span> <span class="math display">\[\begin{equation}
\begin{array}{l}{T_{\mathrm{s}}^{\mathrm{rets}}=\mathrm{RTS}+\delta+\mathrm{SIFS}+\mathrm{CTS}+\delta+\mathrm{SIFS}+H+P+\delta+\mathrm{SIFS}+\mathrm{ACK}+\delta+\mathrm{DIFS}} \\ {T_{\mathrm{c}}^{\mathrm{rets}}=\mathrm{RTS}+\delta+\mathrm{D} \mathrm{IFS}}\end{array} \} RTS/CTS CSMA/CA
\end{equation}\]</span></p>
<p>其中<span class="math inline">\(H=\mathrm{PHY}_{\mathrm{hdr}}+\mathrm{MAC}_{\mathrm{hdr}}\)</span>为帧头，<span class="math inline">\(\delta\)</span>为传输延时。传输成功要要求有且仅有一个节点参与传输，故</p>
<p><span class="math display">\[\begin{equation}
P_{\mathrm{s}}=\frac{n \tau(1-\tau)^{n-1}}{1-(1-\tau)^{n}}
\end{equation}\]</span></p>
<p>最后：</p>
<p><span class="math display">\[\begin{equation}
E[\Psi]=\frac{1}{p_{b}}-1
\end{equation}\]</span></p>
<p>注意这里的所有时间变量都是表示的时隙数量。通过上面的式子我们可以计算出吞吐率<span class="math inline">\(\eqref{eq:throughput}\)</span>。</p>
<blockquote>
<p><em>更新过程</em>: 相比泊松过程，更新过程约束更少，算是对泊松过程的一个推广。我们知道下面的几个定义是可以推出泊松过程的：</p>
<ol type="1">
<li>随机变量<span class="math inline">\(X_i\)</span>独立同分布（i.i.d），服从的是参数为<span class="math inline">\(\lambda\)</span>指数分布；对应到达时间间隔</li>
<li>随机变量<span class="math inline">\(S_n = \sum_{i = 1}^{n}X_i\)</span>；对应到达时间</li>
<li>随机过程<span class="math inline">\(N(t) = \sup (n | S_n \leq t) P(\lambda t)\)</span>。对应发生次数。</li>
</ol>
<p>类比过程，可以得到更新过程的定义，仅仅把1中的随机变量服从的指数分布去掉，不指定具体的分布，后续的2，3保持不变，这样的过程就是更新过程。而泊松过程是更新过程的一个特例吧！ <a href="https://blog.csdn.net/LG1259156776/article/details/49593659" target="_blank" rel="noopener">来源</a></p>
</blockquote>
<h3 id="延时分析">延时分析</h3>
<p>令随机变量<span class="math inline">\(D\)</span>代表延时，其均值为<span class="math inline">\(E[D]\)</span>。平均延时可以通过如下公式进行计算：</p>
<p><span class="math display">\[\begin{equation}
E[D]=E\left[N_{\mathrm{c}}\right]\left(E[B D]+T_{\mathrm{c}}+T_{\mathrm{O}}\right)+\left(E[B D]+T_{\mathrm{s}}\right)
\end{equation}\]</span></p>
<p>其中<span class="math inline">\(E[N_c]\)</span>为一个数据包在最终被接收前经过的冲突的次数。<span class="math inline">\(E[BD]\)</span>为在繁忙的信道条件下，一个节点在访问信道前经过的退避延时的平均值（包含在空闲条件下需要等待的时隙以及在繁忙条件下需要冻结退避计数器的时长）。<span class="math inline">\(T_O\)</span>为在发生碰撞时，再次访问信道前需要等待的时间。而<span class="math inline">\(T_c\)</span>和<span class="math inline">\(T_s\)</span>的定义与上一部分吞吐率分析中定义的一致。平均碰撞次数可以用简单一维马尔科夫链的方法计算得到：</p>
<p><span class="math display">\[\begin{equation}
E\left[N_{\mathrm{c}}\right]=\frac{1}{P_{\mathrm{s}}}-1
\end{equation}\]</span></p>
<p>平均退避掩饰则取决于退避计数器的值及冻结时长。假设退避状态为<span class="math inline">\(b_{i, k}\)</span>，则需要等带<span class="math inline">\(k\)</span>个空时隙才能发送。那么平均退避延时可以按照如下方式计算：</p>
<p><span class="math display">\[\begin{equation}
E[X]=\sum_{i=0}^{m} \sum_{k=1}^{W_{i}-1} k b_{i, k}
\end{equation}\]</span></p>
<p>根据System Model中得到的平稳分布我们可以得到</p>
<p><span class="math display">\[\begin{equation}
\label{eq:backoff_decrement_slots}
E[X]=\frac{b_{0,0}}{6\left(1-p_{b}\right)} \frac{W^{2}\left(1-p-3 p(4 p)^{m}\right)+4 p-1}{(1-4 p)(1-p)}
\end{equation}\]</span></p>
<p>另外我们还需要计算冻结退避计数器的时间。这一时间的平均值为<span class="math inline">\(E[F]\)</span>。为了计算这一均值，我们需要先计算<span class="math inline">\(E[N_{Fr}]\)</span>，即退避计数器到0前会检测到的传输次数。注意到<span class="math inline">\(E[X]\)</span>为退避计数器退避到0的平均时间（时隙数），而<span class="math inline">\(E[\Psi]\)</span>为一次传输前需要经过的空闲时隙的数量，则我们可以计算</p>
<p><span class="math display">\[\begin{equation}
E\left[N_{\mathrm{Fr}}\right]=\frac{E[X]}{\max (E[\Psi], 1)}-1
\end{equation}\]</span></p>
<p>则</p>
<p><span class="math display">\[\begin{equation}
\label{eq:freeze_slots}
E[F]=E\left[N_{\mathrm{Fr}}\right]\left(P_{\mathrm{s}} T_{\mathrm{s}}+\left(1-P_{\mathrm{s}}\right) T_{\mathrm{c}}\right)
\end{equation}\]</span></p>
<p>结合<span class="math inline">\(\eqref{eq:backoff_decrement_slots}\)</span>和<span class="math inline">\(\eqref{eq:freeze_slots}\)</span>，可以得到</p>
<p><span class="math display">\[\begin{equation}
E[B D]=E[X]+E\left[N_{\mathrm{Fr}}\right]\left(P_{\mathrm{s}} T_{\mathrm{s}}+\left(1-P_{\mathrm{s}}\right) T_{\mathrm{c}}\right)
\end{equation}\]</span></p>
<p>最后，<span class="math inline">\(T_O\)</span>的取值规则如下：</p>
<p><span class="math display">\[\begin{equation}
T_{\mathrm{O}}=\left\{\begin{array}{l}{\mathrm{SIFS}+\mathrm{ACK}_{-} \text { timeout }} \\ {\mathrm{SIFS}+\mathrm{CTS}_{-} \text { timeout }}\end{array}\right.
\end{equation}\]</span></p>
<p>至此我们计算得到了延时需要的所有参数。</p>
<h2 id="非饱和条件">非饱和条件</h2>
<p>这部分的内容主要参考<span class="citation" data-cites="malone2007modeling">[3]</span>。之前的理论分析中大多假设了饱和的条件，即每个节点都时钟有包等待发送。这并不能很好地反应大多数实际场景。因此这篇文章在模型中引入了非饱和条件。同时，这篇文章也考虑了异构网络的问题，这里也会一并提及。</p>
<h3 id="模型">模型</h3>
<p>本文的大多数假设依然沿用了Bianchi的经典假设。每个节点的状态变量为<span class="math inline">\((i, k)\)</span>，其中前者表示退避阶段(backoff stage)，后者为退避计数器的取值(backoff counter)。<span class="math inline">\(k\)</span>的取值为<span class="math inline">\([0, W_i - 1]\)</span>，其中<span class="math inline">\(W_i = 2^i W\)</span>为退避窗口。在信道空闲时，<span class="math inline">\(k\)</span>递减。当<span class="math inline">\(k=0\)</span>时，节点尝试发送。</p>
<p>在这里作者引入了新状态<span class="math inline">\((0,k)_e, k \in [0, W_0 - 1]\)</span>。该状态代表完成一次传输之后，没有包等待发送。这个状态被称为post-backoff。引入了新的状态的状态转移图如下：</p>
<figure>
<img src="https://imgs.codewoody.com/uploads/big/f01151f6d7bcba58edda6353bfae5dc8.png" alt><figcaption>这张图里面我们只画了最早的两个退避阶段的状态转移，更高阶段部分的图和上面的状态转移图是一样的。</figcaption>
</figure>
<p>在前两层中，<span class="math inline">\(i\)</span>都是等于0的。当i &gt; 0时，必然发生过碰撞，那么我们肯定有一个包等待发送。</p>
<p>假设对于每个节点都有一个固定的概率<span class="math inline">\(1 - q\)</span>，在每次退避计数器递减时节点的缓冲区中没有包等待发送。反之，<span class="math inline">\(q\)</span>代表了在每个虚拟时隙（Bianchi文章中的概念，相邻两次退避计数器递减的间隔为一个虚拟时隙）存在至少一个可供发送的数据包的概率。</p>
<p>在上面的假设下，我们可以得到转移概率，for <span class="math inline">\(0 &lt; k &lt; W_i\)</span>:</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
0&lt;i \leq m, \quad  P[(i, k-1) |(i, k)]              &amp; = 1 \\
             P\left[(0, k-1)_{e} |(0, k)_{e}\right] &amp; = 1-q \\
             P\left[(0, k-1) |(0, k)_{e}\right]     &amp; = q
\end{aligned}
\end{equation}\]</span></p>
<p>当计数器递减到0，且队列中有（至少一个）包时，我们开始传输。我们假设一个和节点状态有关的概率<span class="math inline">\(p\)</span>为存在其他节点同时传输的概率，即为条件碰撞概率。当发生碰撞时，需要提升退避窗口。当传输成功时，退避阶段缩减为0。若不存在最大重传次数限制，我们就不需要引入额外参数了。对于<span class="math inline">\(0 \leq i \leq m\)</span>和<span class="math inline">\(k \geq 0\)</span>，我们有：</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned} P\left[(0, k)_{e} |(i, 0)\right] &amp;=\frac{(1-p)(1-q)}{W_{0}} \\ P[(0, k) |(i, 0)] &amp;=\frac{(1-p) q}{W_{0}} \\ P[(\min (i+1, m), k) |(i, 0)] &amp;=\frac{p}{W_{\min (i+1, m)}} \end{aligned}
\end{equation}\]</span></p>
<p>最后我们要回过头来讨论<span class="math inline">\((0, 0)_e\)</span>这个状态了。这个状态代表post-backoff阶段完成时，队列里面仍然为空。此时保持在这一状态下。如果有包到达，有三种可能：成功传输，碰撞，信道繁忙（此时开始0-stage退避）。我们记<span class="math inline">\(P_{idle}\)</span>为信道空闲的概率。进而可以得到如下从<span class="math inline">\((0, 0)_e\)</span>出发的转移概率：</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
P[(0, 0)_e | (0, 0)_e] &amp; = 1 - q + \frac{q P_{\text{idle}} (1 - p)}{W_0} \\
k&gt;0, \quad P\left[(0, k)_{e} |(0,0)_{e}\right] &amp; = \frac{q P_{\text { ide }}(1-p)}{W_{0}} \\
k \geq 0, \quad P\left[(1, k) |(0,0)_{e}\right] &amp; = \frac{q P_{\text { idle }} p}{W_{1}} \\
k \geq 0, \quad P\left[(0, k) |(0,0)_{e}\right] &amp;= \frac{q\left(1-P_{\text { idle }}\right)}{W_{0}}
\end{aligned}
\end{equation}\]</span></p>
<blockquote>
<p>其中重点关注一下第二项，右侧的概率可以解析为：1) 有包等待发送，2) 信道空闲，3) 没有发生碰撞，4）选择k作为退避计数器的起始值。</p>
</blockquote>
<p>上面梳理了所有的转移概率，然我们可以计算平稳分布<span class="math inline">\(b(i, k)\)</span>，<span class="math inline">\(b(0, k)_e\)</span>。使用正则化条件：</p>
<p><span class="math display">\[\begin{equation}
\sum_{i = 0}^{m}\sum_{k = 0}^{W_i - 1}b(i, k) + \sum_{k = 0}^{W_0 - 1} b(0, k)_e = 1.
\end{equation}\]</span></p>
<p>最后得到的结果如下：</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
1 / b_{(0, 0)_e} = &amp; (1 - q) + \frac{q^2 W_0(W_0 + 1)}{2 (1 - (1 - q)^{W_0})} \\
&amp; + \frac{q(W_0 + 1)}{2 (1 - q)} \cdot \left(\frac{q^2 W_0}{1 - (1 - q)^{W_0}} + (1 - P_{\text{idle}})(1 - q) - q P_{\text{idle}}(1 - p)\right) \\
&amp; + \frac{pq^2}{2 (1 - q)(1 - p)} \cdot \left(\frac{W_0}{1 - (1 - q)^{W_0}} - (1 - p)P_{\text{idle}}\right)
\\
&amp; \cdot \left(2 W_0 \frac{1 - p - p (2p)^{m - 1}}{1 - 2p} + 1\right).
\end{aligned}
\end{equation}\]</span></p>
<p>推导过程参加原文。然后我们可以计算传输概率<span class="math inline">\(\tau = q(P_{\text{idle}})b(0, 0)_e + \sum_{i \geq 0}b(i, 0) \Rightarrow\)</span></p>
<p><span class="math display">\[\begin{equation}
\tau=b(0,0)_{e}\left(\frac{q^{2} W_{0}}{(1-p)(1-q)\left(1-(1-q)^{W_{0}}\right)}-\frac{q^{2} P_{\text { idle }}}{1-q}\right)
\end{equation}\]</span></p>
<p>上面的式子中参数包括：<span class="math inline">\(p, P_{\text{idle}}, q, W_0, m\)</span>。当<span class="math inline">\(q \rightarrow 1\)</span>时，这个模型退化为Bianchi的模型。</p>
<h3 id="异构网络模型">异构网络模型</h3>
<p>假设一共有<span class="math inline">\(n\)</span>辆车，标记为<span class="math inline">\(l = 1, \dots, n\)</span>。我们把<span class="math inline">\(\tau\)</span>，<span class="math inline">\(p\)</span>这些参数打上节点的下标，变成节点参数<span class="math inline">\(\tau_j\)</span>和<span class="math inline">\(p_l\)</span>，则有</p>
<p><span class="math display">\[\begin{equation}
1 - p_l = \prod_{j \neq l}(1 - \tau_j), \quad \text{for} \quad l = 1, \dots, n
\end{equation}\]</span></p>
<p><strong>待续</strong></p>
<h2 id="非理性信道条件">非理性信道条件</h2>
<p>之前的理论分析都假设了理想信道条件，这里我们讨论一下更加现实的场景<span class="citation" data-cites="daneshgaran2008unsaturated">[4]</span>。</p>
<blockquote>
<p>In this paper, we provide a throughput analysis of the IEEE 802.11 protocol at the data link layer in non- saturated traffic conditions taking into account the impact of both transmission channel and capture effects in Rayleigh fading environment.</p>
</blockquote>
<h3 id="系统模型">系统模型</h3>
<p>假设条件如下：</p>
<ol type="1">
<li>节点数量有限，记为<span class="math inline">\(n\)</span></li>
<li>信道是不完美信道，可能传输出错</li>
<li>capture in Rayleigh fading transmission scenario can occur</li>
<li>包传输基于双路握手方式进行(2-way handshaking access mechanism)，这里的两路握手指的是ACK机制。</li>
</ol>
<p>随机的过程定义和前面的是一致的。二元随机过程<span class="math inline">\((s(t), b(t))\)</span>中的前者表示退避阶段，后者表示退避计数器的值。这里要计算的核心变量是传输概率<span class="math inline">\(\tau\)</span>和碰撞概率<span class="math inline">\(P_{col}\)</span>，需要假设这两个概率是固定的。同时，为了刻画不完美的信道条件，我们需要引入一个新的概率<span class="math inline">\(P_e\)</span>用来表示信道传输错误的概率。我们假设碰撞概率和传输错误概率是独立的。综合这两个量，一个包传输成功的概率为<span class="math inline">\((1 - P_e)(1 - P_{col})\)</span>。因此我们定义一个等价的传输失败概率<span class="math inline">\(P_{eq} = P_e + P_{col} - P_e P_{col}\)</span>。</p>
<p>不完美信道条件还有一个问题是信道占用(channel capture)，代表由于距离因素或其他信道条件，导致某些节点的传输功率比其他同时传输的节点的功率要高。这时，即便发生了碰撞，但是包仍然能够得到传输。从这个意义上来说，信道占用效应可以减少等价的实质的碰撞概率。</p>
<p>对于信道传输错误方面的数据建模，我们做了必要的简化：</p>
<ol type="1">
<li>帧头部分的错误概率忽略；</li>
<li>比特错误率独立</li>
<li>Frame error rate (FER)与包大小指数相关。</li>
</ol>
<p>为了刻画不饱和的状态，引入了一个新的状态<span class="math inline">\(I\)</span>，来表示下面两种情形：</p>
<ul>
<li>在一次成功的传输之后，但是没有包等待发送。</li>
<li>节点处于空闲状态，且队列中没有包等待发送。</li>
</ul>
<p>引入了新状态的的马尔科夫链的状态转移图如下所示：</p>
<p><img src="https://imgs.codewoody.com/uploads/big/64a9413662f187b1c9e62ab0fd9ef1d6.png"></p>
<p>注意这里没有包含802.11的post-backoff特性。不过， 这部分对于理论性能的影响比较小。</p>
<blockquote>
<p>post-backoff特性在上面的「非饱和条件」章节中的文章里进行了讨论和建模。 更多的阅读内容参考：</p>
<ul>
<li><a href="https://www.cwnp.com/forums/posts?postNum=305006" target="_blank" rel="noopener">802.11 backoff precedure</a></li>
<li><a href="https://studfiles.net/preview/2807735/page:8/" target="_blank" rel="noopener">Post-Backoff - StudFiles</a></li>
</ul>
</blockquote>
<p>图中的关键要素和Bianchi提出的模型基本类似。需要注意的是，作者在这里将Channel capture建模成为碰撞的一个子事件。当Channel capture发生时，只允许在AP处有最高接收功率的节点占用信道。在出现Channel capture时，节点进入一个中间状态<span class="math inline">\((i, 0)\)</span>。如果信道占用成功，则节点进入<span class="math inline">\((0, k)\)</span>（队列中还有其他包）或者<span class="math inline">\(I\)</span>（队列为空）的状态。若发送失败，则等同于遭受碰撞，进入状态<span class="math inline">\((i + 1, k)\)</span>。</p>
<p>上图的状态转移图的概率转移矩阵为：</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp; P_{i, k | i, k + 1} &amp; = &amp; 1,                               &amp; &amp; k \in [0, W_i - 2], i \in [0, m] \\
&amp; P_{0, k | i, 0}     &amp; = &amp; q\left(1-P_{e q}\right) / W_{0}, &amp; &amp; k \in\left[0, W_{0}-1\right], i \in[0, m] \\
&amp; P_{i, k | i - 1, 0} &amp; = &amp; P_{eq}/W_i,                      &amp; &amp; k \in\left[0, W_{i}-1\right], i \in[1, m] \\
&amp; P_{m, k | m, 0}     &amp; = &amp; P_{eq} / W_m,                    &amp; &amp; k \in \left[0, W_m - 1\right] \\
&amp; P_{I | i, 0}        &amp; = &amp; (1-q)\left(1-P_{e q}\right),     &amp; &amp; i \in[0, m] \\
&amp; P_{0, k | I}        &amp; = &amp; (1 - q)(1 - P_{eq}),             &amp; &amp; k \in [0, W_0 - 1]\\
&amp; P_{I | I}           &amp; = &amp; 1 - q                            &amp; &amp;
\end{aligned}
\end{equation}\]</span></p>
<p>接下来可以计算平稳分布</p>
<p><span class="math display">\[\begin{equation}
b_{i, k}=\lim _{t \rightarrow \infty} P[s(t)=i, b(t)=k], \forall k \in\left[0, W_{i}-1\right], \forall i \in[0, m]
\end{equation}\]</span></p>
<p>首先我们注意到</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp; {b_{i, 0}} &amp; {=} &amp; {P_{e q} \cdot b_{i-1,0}=P_{e q}^{i} \cdot b_{0,0},} &amp; &amp; {\forall i \in[1, m-1]} \\
&amp; {b_{m, 0}} &amp; {=} &amp; {\frac{P_{e q}^{m}}{1-P_{e q}} \cdot b_{0,0},} &amp; &amp; {i=m}
\end{aligned}
\end{equation}\]</span></p>
<p>上面👆的状态转移图中状态<span class="math inline">\(b_I\)</span>考虑了一次成功传输以后队列为空的情况，以及连续的空闲状态，因此有</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned} b_{I} &amp;=(1-q)\left(1-P_{e q}\right) \cdot \sum_{i=0}^{m} b_{i, 0}+(1-q) \cdot b_{I} \\ &amp;=\frac{(1-q)\left(1-P_{e q}\right)}{q} \cdot \sum_{i=0}^{m} b_{i, 0} \end{aligned}
\end{equation}\]</span></p>
<p>对于其他状态的稳态分布(<span class="math inline">\(k\in [1, W_i - 1]\)</span>)，有</p>
<p><span class="math display">\[\begin{equation}
b_{i, k}=\frac{W_{i}-k}{W_{i}}\left\{\begin{array}{ll}{q\left(1-P_{e q}\right) \cdot \sum_{i=0}^{m} b_{i, 0}+q \cdot b_{I},} &amp; {i=0} \\ {P_{e q} \cdot b_{i-1,0},} &amp; {i \in[1, m-1]} \\ {P_{e q}\left(b_{m-1,0}+b_{m, 0}\right),} &amp; {i=m}\end{array}\right.
\end{equation}\]</span></p>
<p>将<span class="math inline">\(b_I\)</span>代入到上式，有</p>
<p><span class="math display">\[\begin{equation}
\begin{array}{l}{q\left(1-P_{e q}\right) \cdot \sum_{i=0}^{m} b_{i, 0}+q \cdot b_{I}=} \\ {=q\left(1-P_{e q}\right) \cdot \sum_{i=0}^{m} b_{i, 0}+q \cdot \frac{(1-q)\left(1-P_{e q}\right)}{q} \cdot \sum_{i=0}^{m} b_{i, 0}} \\ {=\left(1-P_{e q}\right)[q+(1-q)] \cdot \sum_{i=0}^{m} b_{i, 0}} \\ {=\left(1-P_{e q}\right) \cdot \sum_{i=0}^{m} b_{i, 0}}\end{array}
\end{equation}\]</span></p>
<p>应用正则化条件，有</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
1 &amp; = \sum_{i = 0}^{m}\sum_{k = 0}^{W_i - 1}b_{i, k} + b_I \\
  &amp; = \begin{array}{l}{\frac{b_{0,0}}{2}\left[W\left(\sum_{i=0}^{m-1}\left(2 P_{e q}\right)^{i}+\frac{\left(2 P_{e q}\right)^{m}}{1-P_{e q}}\right)+\frac{1}{1-P_{e q}}\right]+} \\ {+\frac{(1-q)\left(1-P_{e q}\right)}{q} \cdot \sum_{i=0}^{m} b_{i, 0}}\end{array} \\
  &amp; = \begin{array}{l}{\frac{b_{0,0}}{2}\left[W\left(\sum_{i=0}^{m-1}\left(2 P_{e q}\right)^{i}+\frac{\left(2 P_{e q}\right)^{m}}{1-P_{e q}}\right)+\frac{1}{1-P_{e q}}\right]+} \\ {+\frac{(1-q)\left(1-P_{e q}\right)}{q} \cdot \frac{b_{0,0}}{1-P_{e q}}}\end{array} \\
  &amp; = \frac{b_{0,0}}{2}\left[W\left(\sum_{i=0}^{m-1}\left(2 P_{e q}\right)^{i}+\frac{\left(2 P_{e q}\right)^{m}}{1-P_{e q}}\right)+\frac{1}{1-P_{e q}}+\frac{2(1-q)}{q}\right]
\end{aligned}
\end{equation}\]</span></p>
<p>解出来得到如下结果（这不人道！）</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp; b_{0, 0} = \frac{2}{\frac{W\left[\left(1-P_{e q}\right) \sum_{i=0}^{m-1}\left(2 P_{e q}\right)^{i}+\left(2 P_{e q}\right)^{m}\right]+1+2 \frac{1-q}{q}\left(1-P_{e q}\right)}{1-P e q}} \\
&amp; = \frac{2\left(1-P_{e q}\right)}{\left(W-P_{e q} W\right) \frac{1-\left(2 P_{e q}\right)^{m}}{\left(1-2 P_{e q}\right)}+W\left(2 P_{e q}\right)^{m}+1+2 \frac{(1-q)\left(1-P_{e q}\right)}{q}} \\
&amp; =\frac{2\left(1-P_{e q}\right)\left(1-2 P_{e q}\right) q}{q\left[(W+1)\left(1-2 P_{e q}\right)+W P_{e q}\left(1-\left(2 P_{e q}\right)^{m}\right)\right]+2(1-q)\left(1-P_{e q}\right)\left(1-2 P_{e q}\right)} \\
\end{aligned}
\end{equation}\]</span></p>
<p>当<span class="math inline">\(q \rightarrow \infty\)</span>时，即得到了饱和情形下的稳态分布。再如果添加理想信道条件，则<span class="math inline">\(P_e = 0\)</span>，则我们可以将上式简化为</p>
<p><span class="math display">\[\begin{equation}
\lim _{q \rightarrow 1} b_{0,0} \rightarrow \frac{2\left(1-P_{c o l}\right)\left(1-2 P_{c o l}\right)}{(W+1)\left(1-2 P_{c o l}\right)+W P_{c o l}\left(1-\left(2 P_{c o l}\right)^{m}\right)}
\end{equation}\]</span></p>
<p>这个公式和Bianchi中得到的平稳分布式一致的。基于稳态分布我们可以计算传输概率<span class="math inline">\(\tau\)</span></p>
<p><span class="math display">\[\begin{equation}
\begin{aligned} \tau &amp;=\sum_{i=0}^{m} b_{i, 0}=\frac{b_{0,0}}{1-P_{e q}}=\\=&amp; \frac{2 (1 - 2P_{eq})q}{q\left[(W+1)\left(1-2 P_{e q}\right)+W P_{e q}\left(1-\left(2 P_{e q}\right)^{m}\right)\right]+2(1-q)\left(1-P_{e q}\right)\left(1-2 P_{e q}\right)} \end{aligned}
\end{equation}\]</span></p>
<p>继而得到碰撞概率</p>
<p><span class="math display">\[\begin{equation}
P_{c o l}=1-(1-\tau)^{N-1}-P_{c a p}
\end{equation}\]</span></p>
<p>其中<span class="math inline">\(P_{cap}\)</span>为Channel capture的概率。<span class="math inline">\(P_{cap}\)</span>为如下形式，具体推导参考原文:</p>
<p><span class="math display">\[\begin{equation}
P_{c a p}=\sum_{i=1}^{N-1}\left(\begin{array}{c}{N} \\ {i+1}\end{array}\right) \tau^{i+1}(1-\tau)^{N-i-1} P_{c p}\left(\gamma&gt;z_{o} g\left(S_{f}\right) | i\right)
\end{equation}\]</span></p>
<p>继而我们需要求解一个四元非线性方程组，可以通过数值方法求解：</p>
<p><span class="math display">\[\begin{equation}
\left\{\begin{array}{l}{\tau=\frac{2\left(1-2 P_{e q}\right) q}{q\left[(W+1)\left(1-2 P_{e q}\right)+W P_{e q}\left(1-\left(2 P_{e q}\right)^{m}\right)\right]+2(1-q)\left(1-P_{e q}\right)\left(1-2 P_{e q}\right)}} \\ {P_{e q}=1-(1-\tau)^{N-1}-P_{c a p}} \\ {P_{e q}=P_{c o l}+P_{e}-P_{e} \cdot P_{c o l}} \\ {P_{c a p}=\sum_{i=1}^{N-1}\left(\begin{array}{c}{N} \\ {i+1}\end{array}\right) \tau^{i+1}(1-\tau)^{N-i-1} \frac{1}{\left(1+z_{0} g\left(S_{f}\right)\right)^{i}}}\end{array}\right.
\end{equation}\]</span></p>
<p>最后可以计算归一化吞吐率：</p>
<p><span class="math display">\[\begin{equation}
S=\frac{P_{t} \cdot P_{s} \cdot\left(1-P_{e}\right) E[P L]}{\left(1-P_{t}\right) \sigma+P_{t}\left(1-P_{s}\right) T_{c}+P_{t} P_{s}\left(1-P_{e}\right) T_{s}+P_{t} P_{s} P_{e} T_{e}}
\end{equation}\]</span></p>
<p>其中</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp; P_t &amp; = &amp; 1 - (1 - \tau)^N \\
&amp; P_s &amp; = &amp; \frac{N\tau (1 - \tau)^{N - 1} + P_{cap}}{P_t} \\
&amp; T_c &amp; = &amp; H + P L + ACK_{timeout} \\
&amp; T_s &amp; = &amp; H + P L + S I F S + \tau_p + A C K + D I F S + \tau_p
\end{aligned}
\end{equation}\]</span></p>
<p><span class="math inline">\(E[PL]\)</span>为Payload的平均大小，<span class="math inline">\(\sigma\)</span>为空闲时隙的大小。</p>
<h3 id="包达到过程以及q的估算">包达到过程以及<span class="math inline">\(q\)</span>的估算</h3>
<p>包的到达过程建模成参数为<span class="math inline">\(\lambda\)</span>的Poisson过程。参数<span class="math inline">\(\lambda\)</span>代表了单位时间内到达的包的个数。相应的，包到达的间隔为<span class="math inline">\(\frac{1}{\lambda}\)</span>。因此</p>
<p><span class="math display">\[\begin{equation}
q=1-e^{-\lambda E\left[S_{t s}\right]}
\end{equation}\]</span></p>
<p>其中<span class="math inline">\(E[S_{ts}]\)</span>为每个虚拟时隙的大小。</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned} E\left[S_{t s}\right]=&amp;\left(1-P_{t}\right) \cdot \sigma+P_{t}\left(1-P_{s}\right) \cdot T_{c}+\\ &amp;+P_{t} P_{s} P_{e} \cdot T_{e}+P_{t} P_{s}\left(1-P_{e}\right) \cdot T_{s} \end{aligned}
\end{equation}\]</span></p>
<blockquote>
<p>讨论：事实上，从我的分析来看，这里的这个处理方法是存在问题的。问题包含两个方面：1) 如此处理需要假设节点的队列容量只有1，不然我们就需要引入更加复杂的排队论理论来进行分析。当然，引入排队论也是可以分析的；2）利用Poisson过程讨论的时间不应该只限于一个虚拟时隙。而是应该考虑发送延时。即发送完一个包需要的时间内可能生成新的包的概率。而不是只盯着一个时隙。这一延时的计算方法可以参考上面的3.3章节</p>
</blockquote>
<h2 class="unnumbered" id="reference">Reference</h2>
<div id="refs" class="references" role="doc-bibliography">
<div id="ref-bianchi2000performance">
<p>[1] G. Bianchi, “Performance analysis of the ieee 802.11 distributed coordination function,” <em>IEEE Journal on Selected Areas in Communications</em>, vol. 18, no. 3, pp. 535–547, 2000.</p>
</div>
<div id="ref-eustathia2002csma">
<p>[2] E. Ziouva and T. Antonakopoulos, “CSMA/ca performance under high traffic conditions: Throughput and delay analysis,” <em>Computer Communications</em>, vol. 25, no. 3, pp. 313–321, 2002.</p>
</div>
<div id="ref-malone2007modeling">
<p>[3] D. Malone, K. Duffy, and D. Leith, “Modeling the 802.11 distributed coordination function in nonsaturated heterogeneous conditions,” <em>IEEE/ACM Transactions on Networking</em>, vol. 15, no. 1, pp. 159–172, Feb. 2007.</p>
</div>
<div id="ref-daneshgaran2008unsaturated">
<p>[4] F. Daneshgaran, M. Laddomada, F. Mesiti, and M. Mondin, “Unsaturated throughput analysis of ieee 802.11 in presence of non ideal transmission channel and capture effects,” <em>IEEE Transactions on Wireless Communications</em>, vol. 7, no. 4, pp. 1276–1286, 2008.</p>
</div>
</div>

        
      </div>
      
      
      
    </div>
    


  
  
  <ul class="breadcrumb">
    
      
      
        
          
            
          
          
            <li><a href="/knowledge-base/">KNOWLEDGE-BASE</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li><a href="/knowledge-base/academic/">ACADEMIC</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li><a href="/knowledge-base/academic/its/">ITS</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li><a href="/knowledge-base/academic/its/wave/">WAVE</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li><a href="/knowledge-base/academic/its/wave/markov/">MARKOV</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li>2D-MARKOV</li>
          
        
      
    
  </ul>


    
    
    
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://imgs.codewoody.com/uploads/big/0330eb8242d9bfc4873c11450f0ab691.jpg" alt="治部少辅">
            
              <p class="site-author-name" itemprop="name">治部少辅</p>
              <div class="site-description motion-element" itemprop="description">晚来天雨雪，能饮一杯无？</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">113</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">58</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/huangy10" title="GitHub &rarr; https://github.com/huangy10" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.zhihu.com/people/woody-huang" title="知乎 &rarr; https://www.zhihu.com/people/woody-huang" rel="noopener" target="_blank"><i class="fa fa-fw fa-zhihu"></i>知乎</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.jianshu.com/u/927273827560" title="简书 &rarr; https://www.jianshu.com/u/927273827560" rel="noopener" target="_blank"><i class="fa fa-fw fa-jianshu"></i>简书</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bianchi的经典论文"><span class="nav-number">2.</span> <span class="nav-text">Bianchi的经典论文</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#引入信道繁忙条件"><span class="nav-number">3.</span> <span class="nav-text">引入信道繁忙条件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#system-model"><span class="nav-number">3.1.</span> <span class="nav-text">System Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#性能分析"><span class="nav-number">3.2.</span> <span class="nav-text">性能分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#延时分析"><span class="nav-number">3.3.</span> <span class="nav-text">延时分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#非饱和条件"><span class="nav-number">4.</span> <span class="nav-text">非饱和条件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#模型"><span class="nav-number">4.1.</span> <span class="nav-text">模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异构网络模型"><span class="nav-number">4.2.</span> <span class="nav-text">异构网络模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#非理性信道条件"><span class="nav-number">5.</span> <span class="nav-text">非理性信道条件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#系统模型"><span class="nav-number">5.1.</span> <span class="nav-text">系统模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#包达到过程以及q的估算"><span class="nav-number">5.2.</span> <span class="nav-text">包达到过程以及\(q\)的估算</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reference"><span class="nav-number">6.</span> <span class="nav-text">Reference</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">治部少辅</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.1.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="Total Visitors">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="Total Views">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>



  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  
  
  <script id="dsq-count-scr" src="https://codewoody.disqus.com/count.js" async></script>


<script>
  var disqus_config = function() {
    this.page.url = "http://www.codewoody.com/knowledge-base/academic/its/wave/markov/2D-markov.html";
    this.page.identifier = "knowledge-base/academic/its/wave/markov/2D-markov.html";
    this.page.title = '二维马尔科夫链的使用';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://codewoody.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
  

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      
      equationNumbers: {
        autoNumber: 'AMS'
      },
      
      extensions: [ "AMSmath.js",  "AMSsymbols.js"]
      
    }
  });
  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') { next = next.nextSibling }
        if (next && next.nodeName.toLowerCase() === 'br') { next.parentNode.removeChild(next) }
      }
    });
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      document.getElementById(all[i].inputID + '-Frame').parentNode.className += ' has-jax';
    }
  });
</script>
<script src="//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('Copy');
      }, 300);
    }).append(e);
  })
</script>


  

  


  <script src="https://ethantw.github.io/Han/latest/han.min.js"></script>
  
  <script>
    void function(){
      // window.hinst = Han(document.querySelector('.post-body')).setRoutine([
      //   'initCond',
      //   'renderElem',
      //   'renderJiya',
      //   'renderHanging',
      //   'renderHWS',
      //   'correctBasicBD',
      //   'substCombLigaWithPUA'
      // ]).render()
      document.getElementById("refs")
          .setAttribute("lang", "en_US");
    }()

    </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
